오늘은 생활코딩 Docker 입문 수업을 보면서 정리를 해본다.

참고 : https://www.youtube.com/watch?v=EbTJtanJUfE&list=PLuHgQVnccGMDeMJsGq2O-55Ymtx0IdKWf&index=3

---

### Docker

Docker는 가상환경(Container)를 만들고 관리해주는 프로그램이다.

DB가 잘 설치되어있는 환경 또는 웹서버가 잘 설치되어있는 환경을 우리의 PC 또는 서버에 가상환경을 기반하여 실행할 수 있다.
VMware는 이 가상환경에 OS까지 포함하여 제공하는 프로그램이고,
Docker는 가상환경에서 OS를 빼서 좀더 가볍고 빠르게 사용할 수 있도록 해주는 프로그램이다.

**몇가지 Docker 관련 용어들**

- **Docker Hub** : app store 처럼 우리가 필요한 소프트웨어를 찾을 수 있는 서비스
  https://hub.docker.com/search?type=image
- **image** : Docker hub에서 찾아내서 다운받아(**pull** 이라고 한다.) 우리의 컴퓨터에 가지고 있는 것.
- **container** : 현재 실행중인(**running**) image.
- **host** : 컨테이너들을 실행하는 독립된 운영체제

**몇가지 Docker Command-Line 명령어**

```bash
> #도커 허브로부터 이미지 받기
> docker pull httpd
Using default tag: latest
latest: Pulling from library/httpd
a330b6cecb98: Pull complete 
14e3dd65f04d: Pull complete 
fe59ad2e7efe: Pull complete 
68eb42ff9345: Pull complete 
9d5052bb82be: Pull complete 
Digest: sha256:d7c5ce2a3f1c68ae4f0fbf7a08e44bdd3afe80bd294be92645c29f682a24d97c
Status: Downloaded newer image for httpd:latest
docker.io/library/httpd:latest
>
> #이미지 목록
> docker images
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
httpd        latest    5ebe6e00baf9   9 hours ago   138MB
>
> #이미지 실행하기 (백그라운드 아님!)
> docker run --name ws1 httpd
AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message
AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message
[Wed Sep 22 05:53:18.393009 2021] [mpm_event:notice] [pid 1:tid 139950647448704] AH00489: Apache/2.4.49 (Unix) configured -- resuming normal operations
[Wed Sep 22 05:53:18.393144 2021] [core:notice] [pid 1:tid 139950647448704] AH00094: Command line: 'httpd -D FOREGROUND'
```

```bash
> # 컨테이너 목록 확인
> docker ps
CONTAINER ID   IMAGE     COMMAND              CREATED         STATUS         PORTS     NAMES
58ef6c61de70   httpd     "httpd-foreground"   2 minutes ago   Up 2 minutes   80/tcp    ws1
>
> # 컨테이너 멈추기 (container ID 또는 name으로 식별)
> docker stop ws1
ws1
> 
> # 컨테이너 stop은 삭제가 아니다.
> # 컨테이너는 아직 남아있다. ps -a 명령어는 중지된 컨테이너까지 확인할 수 있다.
> docker ps -a
CONTAINER ID   IMAGE     COMMAND              CREATED         STATUS                          PORTS     NAMES
58ef6c61de70   httpd     "httpd-foreground"   5 minutes ago   Exited (0) About a minute ago             ws1
> 
> # 중지된 컨테이너 다시 실행하기
> docker start ws1
ws1
>
> # 컨테이너 로그 확인하기
> docker logs ws1
AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message
AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message
[Wed Sep 22 05:53:18.393009 2021] [mpm_event:notice] [pid 1:tid 139950647448704] AH00489: Apache/2.4.49 (Unix) configured -- resuming normal operations
[Wed Sep 22 05:53:18.393144 2021] [core:notice] [pid 1:tid 139950647448704] AH00094: Command line: 'httpd -D FOREGROUND'
[Wed Sep 22 05:57:08.903669 2021] [mpm_event:notice] [pid 1:tid 139950647448704] AH00492: caught SIGWINCH, shutting down gracefully
AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message
AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message
[Wed Sep 22 05:58:53.470504 2021] [mpm_event:notice] [pid 1:tid 140556821099648] AH00489: Apache/2.4.49 (Unix) configured -- resuming normal operations
[Wed Sep 22 05:58:53.470626 2021] [core:notice] [pid 1:tid 140556821099648] AH00094: Command line: 'httpd -D FOREGROUND'
> 
> # 실행중이면 컨테이너를 제거할 수 없다.
> docker rm ws1
Error response from daemon: You cannot remove a running container 58ef6c61de707ccc88f5b9a404bb2a967e67aef6e56e0bd7d2ecc4e58ff5d516. Stop the container before attempting removal or force remove
> 
> # 중지한 뒤 컨테이너 제거하기
> docker stop ws1
ws1
> docker rm ws1
ws1
>
> # 이미지 삭제하기
> docker rmi httpd
Untagged: httpd:latest
Untagged: httpd@sha256:d7c5ce2a3f1c68ae4f0fbf7a08e44bdd3afe80bd294be92645c29f682a24d97c
Deleted: sha256:5ebe6e00baf9e77921c66f750839caf2adca3f22595504e4d93154fa5393631a
Deleted: sha256:c8eacd0b7766aa4bab63d1c114ce93be8027fb2a0c88da50b5e09790b0861afd
Deleted: sha256:3f8fa98a529aa40c2e32765a86e8c55c28e5a8dcefff8ee008cf4bd4a1fa543f
Deleted: sha256:ea29852a9e48774c6c7c591f30aed436ac02217cebaad9c3ecb5a1ca0464088c
Deleted: sha256:13b9735276cf2b58a2b658c7236d7db46ccd96d8bd4730d14f91ee337fc1e09b
Deleted: sha256:d000633a56813933cb0ac5ee3246cf7a4c0205db6290018a169d7cb096581046
> docker images   
REPOSITORY   TAG       IMAGE ID   CREATED   SIZE
```

docker 상세 사용법 참고 : https://docs.docker.com/reference/



**포트 포워딩**

![image-20210922152837413](/Users/ijeong-in/Documents/TIL/202109/image-20210922152837413.png)

Docker의 컨테이너는 외부에서 바로 접근할 수 없다. 그래서 host의 어떤 포트로 요청이 들어오면 어떤 컨테이너의 포트로 연결해줄지를 정해주는 포트 포워딩 작업이 필요하다.

```bash
> # -p는 포트 포워딩 옵션이다.
> # Host의 8080포트로 요청이 들어오면 Container의 80포트로 요청을 전달해준다.
> docker run --name ws2 -p 8080:80 httpd
```

![image-20210922153424504](/Users/ijeong-in/Documents/TIL/202109/image-20210922153424504.png)

```bash
> # 컨테이너에 명령어 수행하기
> docker exec ws2 ls 
bin
build
cgi-bin
conf
error
htdocs
icons
include
logs
modules
> 
> # 컨테이너의 shell 프로그램 실행하기
> # -i와 -t 옵션을 사용하면 지속적으로 사용할 수 있다.
> docker exec -it ws2 /bin/sh
# 
# ls
bin  build  cgi-bin  conf  error  htdocs  icons  include  logs	modules
# 
# pwd
/usr/local/apache2
# exit
> 

```



**컨테이너에 Host의 파일시스템 연결하기**
호스트에서 파일이 저장되고 수정되기 때문에 안전하고 편하다.

```bash
> 컨테이너 생성할 때 Host의 디렉토리를 컨테이너의 디렉토리에 연결하기
> docker run -p 8888:80 -v /Users/ijeong-in/Desktop/htdocs:/usr/local/apache2/htdocs/ httpd
```

---

